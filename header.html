<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <title>Isaac Cheat Sheet</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
</head>
<body>
<style>
    @font-face {
        font-family: 'VT323';
        src: url('resources/VT323-Regular.ttf');
    }
    body {
        background-color: rgba(75,48,38, 1);
        color: #fff;
    }
    #content {
        padding: 20px;
    }
    h2 {
        font-family: VT323,serif;
        font-size: 40px;
    }
    .isaac-image {
        display: inline-block;
        width: 60px;
        height: 60px;
        text-align: center;
    }
    body.show-names .isaac-image {
        width: 100px;
        height: 100px;
    }
    .isaac-image.selected {
        border: #777777 solid 1px;
    }
    .isaac-image-title {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .isaac-descriptions {
        display: none
    }
    #isaac-description-popup {
        display: none;
        position: absolute;
        /*width: max(600px, 40%);*/
    }
    #isaac-description-popup .modal-content {
        background-color: rgb(101, 67, 55);
    }
    a {
        color: #f9ae47;
        text-decoration: none;
    }
    a:hover {
        color: #f9ae47;
        text-decoration: underline;
    }
    #banner {
        position:sticky;
        top: 0;
        background-color: rgb(101, 67, 55);
        border-bottom: black solid 2px;
        font-family: VT323,serif;
    }
    #banner .row {
        margin: 0;
    }
    #banner form {
        padding: 10px;
    }
    #banner .logo {
        height: 100%;
    }
    .modal-title {
        font-family: VT323,serif;
    }
    #footer {
        margin-top: 20px;
        font-size: 10px;
    }
    #footer p {
        margin-bottom: 0;
    }
    #footer img {
        height: 10px;
    }
    code {
        color: #f9ae47;
        text-decoration: overline underline dotted;
    }
    #descriptions .description {
        display: table;
        width: 100%;
        border-top: black solid 1px;
    }
    #descriptions .description .icon {
        display: table-cell;
        vertical-align: middle;
        width: 80px;
        text-align: center;
    }
    #descriptions .description .body {
        display: table-cell;
        vertical-align: middle;
        padding-left: 10px;
    }
    #descriptions .description .body .title {
        font-size: 30px;
    }
    #descriptions .description .body .text {
        font-family: var(--bs-font-sans-serif);
    }
    .tooltip {
        font-family: VT323,serif;
    }
</style>
<div id="isaac-description-popup">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">
                <span class="icon"></span>
                <span class="text"></span>
            </h5>
        </div>
        <div class="modal-body">
        </div>
    </div>
</div>
<div id="banner">
    <form>
        <div class="row">
            <div class="col-1">
                <img class="logo" src="resources/isaac.webp" />
            </div>
            <div class="col-2">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="groupByCategory" checked>
                    <label class="form-check-label" for="groupByCategory">
                        Group by category
                    </label>
                </div>
            </div>
            <div class="col-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="showNames">
                    <label class="form-check-label" for="showNames">
                        Show names
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="showActivablesBars">
                    <label class="form-check-label" for="showActivablesBars">
                        Show Activables Bars
                    </label>
                </div>
            </div>
            <div class="col-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="order" id="orderAlphabetically">
                    <label class="form-check-label" for="orderAlphabetically">
                        Order alphabetically
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="order" id="orderByColor" checked>
                    <label class="form-check-label" for="orderByColor">
                        Order by color
                    </label>
                </div>
            </div>
            <div class="col-3">
                <div class="input-group input-group-sm mb-3">
                    <span class="input-group-text" id="search-icon">üîç</span>
                    <input type="text" class="form-control" placeholder="" aria-label="search" aria-describedby="search-icon" id="search">
                    <button class="btn btn-outline-secondary" type="button" id="cancel-search">‚ùå</button>
                </div>
            </div>
        </div>
    </form>
    <div id="descriptions">
    </div>
</div>
    <script>
    let browsing = false;
    let groupByCategory = true;
    function handleGroupByCategory() {
        let newGroupByCategory = $('#groupByCategory').prop('checked');
        if (newGroupByCategory == groupByCategory) {
            return;
        }
        groupByCategory = newGroupByCategory;
        runGroupByCategory();
    }
    function runGroupByCategory() {
        if (groupByCategory) {
            $("h2").show();
            $(".all-category").hide();
            $(".category").each(function(i, category) {
                let categoryId = $(category).attr("id");
                let elements = $(".isaac-image[data-isaac-category=\"" + categoryId + "\"]").detach();
                elements.sort(currentSort);
                elements.prependTo($(category).find(".images"));
            });
        } else {
            $(".all-category").show();
            $("h2").hide();
            let allElements = [];
            $(".category").each(function(i, category) {
                let categoryId = $(category).attr("id");
                let elements = $(".isaac-image[data-isaac-category=\"" + categoryId + "\"]").detach();
                elements.each(function (i, e) { allElements.push(e) });
            });
            allElements.sort(currentSort);
            allElements.forEach(function(item) {
                $(item).prependTo(".all-category");
            })
        }
    }
    function alphaSort(e1, e2) {
        let title1 = $(e1).find("a").attr("title");
        let title2 = $(e2).find("a").attr("title");
        return title1.localeCompare(title2);
    }
    function colorScore(e) {
        let title = $(e).find("a").attr("title");
        let hsl = new iro.Color(isaac_images_colors[title]).hsl;
        if (hsl.s < 8 || hsl.l < 8) {
            return hsl.l / 100.0
        } else {
            return 1 + hsl.h / 360.0
        }
        return hsl.h
    }
    function colorSort(e1, e2) {
        let score1 = colorScore(e1);
        let score2 = colorScore(e2);
        return score2 - score1;
    }
    let sortAlpha = false;
    let currentSort = colorSort;
    function handleSort() {
        let newSortAlpha = $('#orderAlphabetically').prop('checked');
        if (newSortAlpha == sortAlpha) {
            return;
        }
        sortAlpha = newSortAlpha;
        runSort();
    }
    function runSort() {
        if (sortAlpha) {
            currentSort = alphaSort;
        } else {
            currentSort = colorSort;
        }
        if (groupByCategory) {
            $(".category").each(function(i, category) {
                let elements = $(category).find(".images").children().detach();
                elements.sort(currentSort);
                elements.prependTo($(category).find(".images"));
            });
        } else {
            let elements = $(".all-category").children().detach();
            elements.sort(currentSort);
            elements.prependTo(".all-category");
        }
    }
    let showNames = false;
    function handleShowNames() {
        let newShowNames = $('#showNames').prop('checked');
        if (newShowNames == showNames) {
            return;
        }
        showNames = newShowNames;
        runShowNames();
    }
    function runShowNames() {
        if (showNames) {
            $(".isaac-image").each(function(i, e) {
                let title = $(e).find("a").attr("title");
                $("<span class=\"isaac-image-title\">" + title + "</span>").appendTo(e);
            });
            $("body").addClass("show-names")
        } else {
            $(".isaac-image-title").remove();
            $("body").removeClass("show-names");
        }
    }
    let showActivablesBars = false;
    function handleShowActivablesBars() {
        let newShowActivablesBars = $('#showActivablesBars').prop('checked');
        if (newShowActivablesBars == showActivablesBars) {
            return;
        }
        showActivablesBars = newShowActivablesBars;
        runShowActivablesBars();
    }
    function runShowActivablesBars() {
        if (showActivablesBars) {
            $(".isaac-image span:nth-of-type(2)").show()
        } else {
            $(".isaac-image span:nth-of-type(2)").hide()            
        }
    }
    function handleSearch() {
        filter();
    }
    function filter() {
        let texts = $("#search").val().toLowerCase().split(" ");
        $(".isaac-image").each(function(i, e) {
            let $e = $(e);
            let title = $e.find("a").attr("title");
            let titleMatch = title.toLowerCase();
            let match = true;
            for (let i = 0; i < texts.length; i++) {
                match = match && titleMatch.indexOf(texts[i]) >= 0;
                if (!match) {
                    break;
                }
            }
            if (match) {
                $(e).show();
            } else {
                $(e).hide();
            }
        });
        $(".category").each(function(i, e) {
            if ($(e).find(".isaac-image:visible").length == 0) {
                $(e).find("h2").hide();
            } else {
                $(e).find("h2").show();
            }
        });
        let matches = $(".isaac-image:visible")
        if (matches.length == 1) {
            pinDescription(matches[0]);
        }
    }
    function handleCancelSearch() {
        $("#search").val("");
        handleSearch();
        $("#descriptions").empty();
        $(".isaac-image.selected").removeClass("selected");
    }
    function showDescription(isaacImage, e) {
        $("#isaac-description-popup .modal-body").empty();
        $("#isaac-description-popup .modal-title .text").empty();
        $("#isaac-description-popup .modal-title .icon").empty();

        let title = $(isaacImage).find("a").attr("title");
        let category = $(isaacImage).data("isaac-category");
        let i = all_names[category].indexOf(title);
        let desc = $("#" + category + " .isaac-description:nth(" + i + ")");
        let img = $(isaacImage).find("img");
        desc.clone().appendTo("#isaac-description-popup .modal-body");
        $("#isaac-description-popup .modal-title .text").text(title);
        img.clone().appendTo("#isaac-description-popup .modal-title .icon");
        let popupWidth = $("#isaac-description-popup").width();
        let popupHeight = $("#isaac-description-popup").height();
        let left = Math.min(e.pageX + 20, window.innerWidth - popupWidth - 20);
        let top = e.pageY + 20;
        if (top + popupHeight > window.innerHeight + window.pageYOffset) {
            top = e.pageY - popupHeight - 20;
        }
        $("#isaac-description-popup").css({top: top, left: left});
    }
    function handlePinDescription(e) {
        e.preventDefault();
        e.stopPropagation();
        pinDescription(this);
        return false;
    }
    function pinDescription(element) {
        $("#descriptions").empty();
        $(".isaac-image").removeClass("selected");
        $(element).addClass("selected");
        let title = $(element).find("a").attr("title");
        let href = $(element).find("a").attr("href");
        let category = $(element).data("isaac-category");
        let i = all_names[category].indexOf(title);
        let desc = $("#" + category + " .isaac-description:nth(" + i + ")");
        html = "<div class=\"description\"><div class=\"icon\">"
        html += $(element).html();
        html += "</div>";
        html += "<div class=\"body\"><div class=\"title\"><a href=\"";
        html += href;
        html += "\">";
        html += title;
        html += "</a></div><div class=\"text\">";
        html += desc.html();
        html += "</div></div>";
        $(html).find(".icon span:nth-of-type(2)").show();
        $(html).appendTo("#descriptions");
        $("#descriptions .icon span:nth-of-type(2)").show();
    }
    function selectItem() {
        let visible = $(".isaac-image:visible");
        if (visible.length > 0) {
            pinDescription(visible[0]);
        }
    }
    function selectNext(nextSelector) {
        let visible = $(".isaac-image:visible");
        let selected = $(".isaac-image.selected");
        let selectedTitle = selected.find("a").attr("title");
        let next = null;
        for (let i = 0; i < visible.length; i++) {
            next = nextSelector(i, selected, $(visible[i]));
            if (next != null) {
                break;
            }
        }
        if (next != null) {
            if (next < 0) {
                next = visible.length - 1;
            } else if (next >= visible.length) {
                next = 0;
            }
            pinDescription(visible[next]);
        }
    }
    function selectRight() {
        selectNext(function(i, selected, visible) {
            let selectedTitle = selected.find("a").attr("title");
            let title = visible.find("a").attr("title");
            if (selectedTitle == title) {
                return i + 1;
            }
            return null;            
        });
    }
    function selectLeft() {
        selectNext(function(i, selected, visible) {
            let selectedTitle = selected.find("a").attr("title");
            let title = visible.find("a").attr("title");
            if (selectedTitle == title) {
                return i - 1;
            }
            return null;            
        });
    }
    function selectUp() {
    }
    function selectDown() {
    }
    $(document).ready(function() {
        $("#groupByCategory").click(handleGroupByCategory);
        $("#orderAlphabetically").click(handleSort);
        $("#orderByColor").click(handleSort);
        $("#showNames").click(handleShowNames);
        $("#showActivablesBars").click(handleShowActivablesBars);
        $("#search").keyup(handleSearch);
        $("form").submit(function() {
            selectItem();
            $("#search").blur();
            browsing = true;
            return false;
        });
        $("#cancel-search").click(handleCancelSearch);
        runGroupByCategory();
        runShowNames();
        runShowActivablesBars();
        filter();
        runSort();

        /*
        $(".isaac-image").hover(
            function(e) {
                $("#isaac-description-popup").show();
                showDescription(this, e);
            },
            function() {
                $("#isaac-description-popup").hide();
            }
        );
        */
        $(".isaac-image").each(function(i, e) {
            let title = $(e).find("a").attr("title");
            $(e).attr("data-bs-toggle", "tooltip");
            $(e).attr("data-bs-placement", "bottom");
            $(e).attr("title", title);
            new bootstrap.Tooltip(e, { "animation": false });
        });
        $(".isaac-image").click(handlePinDescription)
        $(document.body).on('keyup', function(e) {
            if (e.keyCode == 27 /*ESC*/) {
                handleCancelSearch();
                $("#descriptions").empty();
                $("#search").focus();
                browsing = false;
            } else if (browsing) {
                if (e.keyCode == 39 /*RIGHT*/) {
                    selectRight();
                } else if (e.keyCode == 37 /*LEFT*/) {
                    selectLeft();
                } else if (e.keyCode == 38 /*UP*/) {
                    selectUp();
                } else if (e.keyCode == 40 /*DOWN*/) {
                    selectDown();
                }
            }
        });
    });
    </script>
    <div id="content">
        <div class="all-category" id="All" style="display: none"></div>
